{
	{$CADDY_GLOBAL_OPTIONS}

	frankenphp {
		# worker /path/to/your/worker.php
		{$FRANKENPHP_CONFIG}
	}
}

{$CADDY_EXTRA_CONFIG}

{$SERVER_NAME:localhost} {
	# log {
	# 	# Redact the authorization query parameter that can be set by Mercure
	# 	format filter {
	# 		request>uri query {
	# 			replace authorization REDACTED
	# 		}
	# 	}
	# }

	root * .
	encode zstd br gzip

	# Uncomment the following lines to enable Mercure and Vulcain modules

	# mercure {
	#	# Transport to use (default to Bolt)
	#	transport_url {$MERCURE_TRANSPORT_URL:bolt:///data/mercure.db}
	#	# Publisher JWT key
	#	publisher_jwt {env.MERCURE_PUBLISHER_JWT_KEY} {env.MERCURE_PUBLISHER_JWT_ALG}
	#	# Subscriber JWT key
	#	subscriber_jwt {env.MERCURE_SUBSCRIBER_JWT_KEY} {env.MERCURE_SUBSCRIBER_JWT_ALG}
	#	# Allow anonymous subscribers (double-check that it's what you want)
	#	anonymous
	#	# Enable the subscription API (double-check that it's what you want)
	#	subscriptions
	#	# Extra directives
	#	{$MERCURE_EXTRA_DIRECTIVES}
	# }

	# vulcain

	# Begin - Grav Security
	# deny all direct access for these folders
	rewrite /(\.git|cache|bin|logs|backups|tests)/.* /403

	# deny running scripts inside core system folders
	rewrite /(system|vendor)/.*\.(txt|xml|md|html|htm|shtml|shtm|yaml|yml|php|php2|php3|php4|php5|phar|phtml|pl|py|cgi|twig|sh|bat)$ /403

	# deny running scripts inside user folder
	rewrite /user/.*\.(txt|md|yaml|yml|php|php2|php3|php4|php5|phar|phtml|pl|py|cgi|twig|sh|bat)$ /403

	# deny access to specific files in the root folder
	rewrite /(LICENSE\.txt|composer\.lock|composer\.json|nginx\.conf|web\.config|htaccess\.txt|\.htaccess) /403

	respond /403 403
	## End - Grav Security

	# global rewrite should come last.
	try_files {path} {path}/ /index.php?_url={uri}&{query}

	{$CADDY_SERVER_EXTRA_DIRECTIVES}

	php_server
}
